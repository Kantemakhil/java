OIICIPON_FIND_RGAGYLOCS{
SELECT AL.AGY_LOC_ID code , AL.DESCRIPTION description FROM AGENCY_LOCATIONS AL , CASELOAD_AGENCY_LOCATIONS CAL WHERE CAL.CASELOAD_ID = :CASELOADID AND CAL.AGY_LOC_ID NOT IN ('TRN' ,'OUT' ) AND CAL.AGY_LOC_ID = AL.AGY_LOC_ID AND AL.DEACTIVATION_DATE IS NULL ORDER BY AL.AGY_LOC_ID
}
OIICIPON_OFFCIPDETAILS_FIND_OFFENDER_CIP_DETAILS{
select B.* , ( select LPAD(LTRIM( (FLOOR(B.LV_REM_TIME::numeric/60))::text),2,'0')||':'||LPAD(LTRIM((ROUND(MOD(B.LV_REM_TIME::numeric,60)))::text),2,'0') from DUAL) as NBT_HOURS_SERVED, (SELECT FLOOR(LV_TT_IN_HOURS/24) FROM DUAL) as NBT_DAYS_SERVED from ( select A.*, ( select ROUND((mod(coalesce(A.LV_TT_IN_HOURS, 0)::numeric, 24)* 60), 2) from DUAL ) as LV_REM_TIME from ( select OCD.OFFENDER_BOOK_ID, OCD.AGY_LOC_ID , OCD.PLACEMENT_TYPE, OCD.PLACEMENT_REASON_CODE, OCD.REVIEW_DATE, OCD.EXPIRY_DATE, VHB.OFFENDER_ID_DISPLAY , VHB.LAST_NAME , VHB.FIRST_NAME , VHB.OFFENDER_ID, ( select ROUND((extract(EPOCH from coalesce(OCD.release_time,CURRENT_TIMESTAMP) - OCD.effective_time) / 3600),2) as HOURS from DUAL ) as LV_TT_IN_HOURS from OFFENDER_CIP_DETAILS OCD, ( select O.OFFENDER_ID_DISPLAY, O.OFFENDER_ID, O.FIRST_NAME , O.LAST_NAME, OB.OFFENDER_BOOK_ID from OFFENDERS O , OFFENDER_BOOKINGS OB where O.OFFENDER_ID = OB.OFFENDER_ID ) VHB where OCD.AGY_LOC_ID = :AGYLOCID and (coalesce(:PLACEMENTTYPE, 'NULL') = 'NULL' or OCD.PLACEMENT_TYPE = :PLACEMENTTYPE ) and (coalesce(:PLACEMENTREASONCODE, 'NULL') = 'NULL' or OCD.PLACEMENT_REASON_CODE = :PLACEMENTREASONCODE ) and VHB.OFFENDER_BOOK_ID = OCD.OFFENDER_BOOK_ID and OCD.EXPIRY_DATE > CURRENT_TIMESTAMP ) A) B
}