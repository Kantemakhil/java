GET_LAST_TO_AGY_LOC_ID{
SELECT  DISTINCT OFF_EM.TO_AGY_LOC_ID  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

GET_LAST_TO_CITY{
SELECT  distinct OFF_EM.TO_CITY  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

GET_V_DIRECTION{
SELECT OFF_EM.DIRECTION_CODE  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

GET_NEXT_DIRECTION_CODE{
SELECT REF_CODE.CODE FROM REFERENCE_CODES REF_CODE WHERE REF_CODE.DOMAIN = 'MOVE_DIRECT' AND REF_CODE.CODE <> :V_DIRECTION AND REF_CODE.ACTIVE_FLAG = 'Y' AND REF_CODE.EXPIRED_DATE IS NULL
}

GET_LAST_MOVEMENT_REASON_CODE{
SELECT distinct OFF_EM.MOVEMENT_REASON_CODE  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}
GET_LAST_FROM_AGY_LOC_ID{
SELECT  distinct OFF_EM.FROM_AGY_LOC_ID  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

GET_LAST_MOVEMENT_CODE{
SELECT distinct OFF_EM.MOVEMENT_TYPE  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

GET_LAST_FROM_CITY{
SELECT distinct OFF_EM.FROM_CITY  FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM WHERE OFF_EM.OFFENDER_BOOK_ID = :P_BOOKING_ID and OFF_EM.movement_seq  = (SELECT MAX(MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS OFF_EM_MAX_SEQ WHERE OFF_EM_MAX_SEQ.OFFENDER_BOOK_ID = :P_BOOKING_ID)
}

CHECK_ACTIVE_SENTENCE{
SELECT COUNT(*) FROM OFFENDER_SENTENCES OS, SENTENCE_CALC_TYPES SCT WHERE OS.OFFENDER_BOOK_ID = :P_OFFENDER_BOOK_ID AND OS.SENTENCE_CALC_TYPE = SCT.SENTENCE_CALC_TYPE AND OS.SENTENCE_CATEGORY = SCT.SENTENCE_CATEGORY AND SCT.SENTENCE_TYPE IN ('ALL', 'INST') AND OS.SENTENCE_STATUS = 'A'
}


CHECK_RELEASE_DATE_CUR{
 SELECT release_date, movement_reason_code FROM offender_release_details WHERE offender_book_id = :p_offender_book_id
 }
 
 GET_TO_ADDRESS{
 SELECT EXT1.TO_ADDRESS_ID FROM OFFENDER_EXTERNAL_MOVEMENTS EXT1 WHERE EXT1.OFFENDER_BOOK_ID = :P_OFFENDER_BOOK_ID AND EXT1.MOVEMENT_SEQ = ( SELECT MAX(EXT2.MOVEMENT_SEQ) FROM OFFENDER_EXTERNAL_MOVEMENTS EXT2 WHERE EXT2.OFFENDER_BOOK_ID = EXT1.OFFENDER_BOOK_ID) LIMIT 1
 }
 