
OIUIWPVE_FIND_RGSTATUS {
 	SELECT REF_CODE.DESCRIPTION  DESCRIPTION        ,REF_CODE.CODE  CODE FROM   REFERENCE_CODES REF_CODE WHERE   DOMAIN = 'DOCUMENT_STS'  AND ((ACTIVE_FLAG = 'Y' AND EXPIRED_DATE IS NULL ) OR :MODE = 'ENTER-QUERY' ) ORDER BY LIST_SEQ ,DESCRIPTION
}

OIUIWPVE_FIND_RGTEMPLATE {
SELECT TEMPLATE_NAME , DESCRIPTION , TEMPLATE_ID , ACTIVE_FLAG   FROM IWP_TEMPLATES TMPT  WHERE 
 (    coalesce (:POBJECTTYPE , 'XXXX' ) NOT IN ( 'CNOTE' , 'TASK' , 'MEMO'  )    AND OBJECT_TYPE<>'REPORT'    
 AND IWP_10G_IS_TEMPLATE_ACCESSIBLE_u ( TEMPLATE_ID ,:MODULENAME,:username  ) = 'Y'  
 AND (  TEMPLATE_ID IN 
 (SELECT TEMPLATE_ID  FROM IWP_TEMPLATE_MODULES ITM1   
 WHERE ITM1.MODULE_NAME = :MODULENAME AND (ITM1.BLOCK_NAME IS NULL OR  ITM1.BLOCK_NAME = :BLOCKNAME )
 AND ITM1.ACTIVE_FLAG = 'Y' )   )   AND (TMPT.ACTIVE_FLAG = 'Y'   
 OR  EXISTS ( SELECT '1'    FROM IWP_DOCUMENTS DOC  
 WHERE DOC.TEMPLATE_ID = TMPT.TEMPLATE_ID
 AND (:OFFENDERBOOKID IS NULL OR DOC.OFFENDER_BOOK_ID = :OFFENDERBOOKID )
 AND (:POBJECTID IS NULL   OR (DOC.OBJECT_TYPE = :POBJECTTYPE AND DOC.OBJECT_ID = :POBJECTID ) )    ))
 AND (    (:POBJECTTYPE IS NULL OR :POBJECTTYPE NOT IN ('PSR_REP' , 'VIC_NOTIF' )  )   
 OR ( :POBJECTTYPE = 'PSR_REP'AND TMPT.TEMPLATE_ID IN ( SELECT TEMPLATE_ID   FROM IWP_TEMPLATE_OBJECTS  
 WHERE OBJECT_TYPE = 'ORDER'AND OBJECT_CODE = :PTYPE ))    
 OR(   :POBJECTTYPE = 'COMM_REP'AND TEMPLATE_ID IN ( SELECT TEMPLATE_ID FROM IWP_TEMPLATE_OBJECTS WHERE OBJECT_TYPE = 'ORDER'    
 AND OBJECT_CODE = :PTYPE )AND ACTIVE_FLAG = 'Y' )  
 OR (  :POBJECTTYPE = 'VIC_NOTIF' AND TMPT.TEMPLATE_ID IN  
( SELECT TEMPLATE_ID FROM IWP_TEMPLATE_OBJECTS    
 WHERE IWP_TEMPLATE_OBJECTS.OBJECT_TYPE = 'VIC_NOTIF'  AND IWP_TEMPLATE_OBJECTS.OBJECT_CODE = :PTYPE  
 AND (IWP_TEMPLATE_OBJECTS.ACTIVE_FLAG = 'Y'    
 OR  EXISTS ( SELECT '1' 
 FROM IWP_DOCUMENTS DOC    
 WHERE DOC.TEMPLATE_ID = IWP_TEMPLATE_OBJECTS.TEMPLATE_ID    
 AND (    :OFFENDERBOOKID IS NULL
 OR DOC.OFFENDER_BOOK_ID = :OFFENDERBOOKID ) ) )
 ) )  )   ) 
 OR (:POBJECTTYPE IN ( 'CNOTE' , 'TASK' , 'MEMO'  ) AND TMPT.TEMPLATE_ID IN (SELECT TEMPLATE_ID    
 FROM WORK_IWP_TEMPLATES WHERE WORK_ID IN ( SELECT WORK_ID FROM WORKS WHERE WORKFLOW_TYPE = :POBJECTTYPE  AND WORK_TYPE = :PTYPE
 AND WORK_SUB_TYPE = :PSUBTYPE )AND ACTIVE_FLAG = 'Y' )   AND OBJECT_TYPE<>'REPORT') ORDER BY TEMPLATE_NAME

  

}

OIUIWPVE_IWPDOC_FIND_IWP_DOCUMENTS {
 SELECT  DOCUMENT_ID, 
OFFENDER_BOOK_ID, 
DOCUMENT_NAME, 
TEMPLATE_ID,
COMMENT_TEXT,
ACTIVE_FLAG,
LOCATION,
OBJECT_ID,
OBJECT_TYPE,
DOCUMENT_STATUS,
DOCUMENT_BODY,
DATE_CREATED,
DATE_MODIFIED,
USER_CREATED,
USER_MODIFIED,
CREATE_DATETIME,
CREATE_USER_ID,
MODIFY_DATETIME,
MODIFY_USER_ID,
SEAL_FLAG,
DOCUMENT_CONTEXT FROM IWP_DOCUMENTS  /* where  */
}
OIUIWPVE_IWPDOC_UPDATE_IWP_DOCUMENTS {
update IWP_DOCUMENTS set DOCUMENT_STATUS = :documentStatus, MODIFY_DATETIME =current_timestamp , MODIFY_USER_ID =:modifyUserId where OFFENDER_BOOK_ID = :offenderBookId and TEMPLATE_ID = :templateId
}


OIUIWPVE_POPULATE_DEFLT_DOC_ {
	SELECT TEMPLATE_NAME, DESCRIPTION, TEMPLATE_ID, ACTIVE_FLAG FROM IWP_TEMPLATES TMPT WHERE TEMPLATE_ID = P_TEMPLATE_ID
}

OIUIWPVE_POPULATE_DEFLT_DOC_ {
SELECT TEMPLATE_ID FROM IWP_TEMPLATE_MODULES WHERE MODULE_NAME = :MODULENAME AND TEMPLATE_ID IN (SELECT TEMPLATE_ID FROM IWP_TEMPLATES TMPT WHERE ((:POBJECTTYPE IS NULL AND IWP_10G_IS_TEMPLATE_ACCESSIBLE(TEMPLATE_ID, :MODULENAME) = 'Y' AND (EXISTS (SELECT '1' FROM IWP_DOCUMENTS DOC WHERE DOC.TEMPLATE_ID = TMPT.TEMPLATE_ID AND DOC.OFFENDER_BOOK_ID = :OFFENDERBOOKID) OR TMPT.ACTIVE_FLAG = 'Y')) OR (:POBJECTTYPE IN ('CNOTE', 'TASK', 'MEMO') AND TEMPLATE_ID IN (SELECT TEMPLATE_ID FROM WORK_IWP_TEMPLATES WHERE WORK_ID IN (SELECT WORK_ID FROM WORKS WHERE WORKFLOW_TYPE = :POBJECTTYPE AND WORK_TYPE = :PTYPE AND WORK_SUB_TYPE = :PSUBTYPE) AND ACTIVE_FLAG = 'Y') OR (:POBJECTTYPE = 'PSR_REP' AND TEMPLATE_ID IN (SELECT TEMPLATE_ID FROM IWP_TEMPLATE_OBJECTS WHERE OBJECT_TYPE = 'ORDER' AND OBJECT_CODE = :PTYPE ) AND ACTIVE_FLAG = 'Y' ) OR(   :POBJECTTYPE = 'STG' AND TEMPLATE_ID IN ( SELECT TEMPLATE_ID FROM IWP_TEMPLATE_MODULES ITM WHERE ITM.MODULE_NAME = 'OIITGDET' AND ITM.ACTIVE_FLAG = 'Y' ) AND TMPT.ACTIVE_FLAG = 'Y' ) OR(   :POBJECTTYPE = 'OIC' AND TEMPLATE_ID IN ( SELECT TEMPLATE_ID FROM IWP_TEMPLATE_MODULES ITM WHERE ITM.MODULE_NAME = 'OIDINCDE' AND ITM.ACTIVE_FLAG = 'Y' ) AND TMPT.ACTIVE_FLAG = 'Y' ) )) AND OBJECT_TYPE <> 'REPORT')
}

OIUIWPVE_IS_TEMPLATE_HAS_BODY_ {
	SELECT 'Y' FROM IWP_TEMPLATES TMPT WHERE TEMPLATE_ID = P_TEMPLATE_ID AND TEMPLATE_BODY IS NULL
}

OIUIWPVE_CHECK_VIC_NOTIF_TEMPL_ACTIVE_ {
	SELECT NVL(IWP_TEMPLATE_OBJECTS.ACTIVE_FLAG, 'N') FROM IWP_TEMPLATE_OBJECTS WHERE IWP_TEMPLATE_OBJECTS.OBJECT_TYPE = 'VIC_NOTIF' AND IWP_TEMPLATE_OBJECTS.OBJECT_CODE = :PTYPE AND IWP_TEMPLATE_OBJECTS.TEMPLATE_ID = P_TEMPLATE_ID
}
