
OTDCNTAC_OFFTXN_FIND_OFFENDER_TRANSACTIONS {
 	SELECT TXN_ID ,TXN_ENTRY_SEQ ,CASELOAD_ID ,OFFENDER_ID ,OFFENDER_BOOK_ID ,TXN_POSTING_TYPE ,TXN_TYPE ,TXN_ENTRY_DESC ,TXN_ENTRY_AMOUNT ,TXN_ENTRY_DATE ,SUB_ACCOUNT_TYPE ,TXN_REFERENCE_NUMBER ,MODIFY_DATE ,RECEIPT_NUMBER ,SLIP_PRINTED_FLAG ,TRANSFER_CASELOAD_ID ,RECEIPT_PRINTED_FLAG ,PRE_WITHHOLD_AMOUNT ,DEDUCTION_FLAG ,CLOSING_CHEQUE_NUMBER ,REMITTER_NAME ,PAYEE_CODE ,PAYEE_NAME_TEXT ,PAYEE_CORPORATE_ID ,PAYEE_PERSON_ID ,ADJUST_TXN_ID ,ADJUST_TXN_ENTRY_ID ,ADJUST_OFFENDER_ID ,ADJUST_ACCOUNT_CODE ,TXN_ADJUSTED_FLAG ,DEDUCTION_TYPE ,INFO_NUMBER ,HOLD_CLEAR_FLAG ,HOLD_UNTIL_DATE ,HOLD_NUMBER ,GROSS_AMOUNT ,GROSS_NET_FLAG ,REMITTER_ID ,APPLY_SPENDING_LIMIT_AMOUNT ,RECEIPT_PENDING_PRINT_FLAG ,SEAL_FLAG ,ORG_TXN_TYPE ,CREATE_DATETIME ,CREATE_USER_ID ,MODIFY_DATETIME ,MODIFY_USER_ID   FROM OFFENDER_TRANSACTIONS 
}
OTDCNTAC_OFFTXN_INSERT_OFFENDER_TRANSACTIONS {
	INSERT INTO OFFENDER_TRANSACTIONS(TXN_ID ,TXN_ENTRY_SEQ ,CASELOAD_ID ,OFFENDER_ID ,OFFENDER_BOOK_ID ,TXN_POSTING_TYPE ,TXN_TYPE ,TXN_ENTRY_DESC ,TXN_ENTRY_AMOUNT ,TXN_ENTRY_DATE ,SUB_ACCOUNT_TYPE ,TXN_REFERENCE_NUMBER ,MODIFY_DATE ,RECEIPT_NUMBER ,SLIP_PRINTED_FLAG ,TRANSFER_CASELOAD_ID ,RECEIPT_PRINTED_FLAG ,PRE_WITHHOLD_AMOUNT ,DEDUCTION_FLAG ,CLOSING_CHEQUE_NUMBER ,REMITTER_NAME ,PAYEE_CODE ,PAYEE_NAME_TEXT ,PAYEE_CORPORATE_ID ,PAYEE_PERSON_ID ,ADJUST_TXN_ID ,ADJUST_TXN_ENTRY_ID ,ADJUST_OFFENDER_ID ,ADJUST_ACCOUNT_CODE ,TXN_ADJUSTED_FLAG ,DEDUCTION_TYPE ,INFO_NUMBER ,HOLD_CLEAR_FLAG ,HOLD_UNTIL_DATE ,HOLD_NUMBER ,GROSS_AMOUNT ,GROSS_NET_FLAG ,REMITTER_ID ,APPLY_SPENDING_LIMIT_AMOUNT ,RECEIPT_PENDING_PRINT_FLAG ,SEAL_FLAG ,ORG_TXN_TYPE ,CREATE_DATETIME ,CREATE_USER_ID, modify_user_id ) VALUES(:txnId ,:txnEntrySeq ,:caseloadId ,:offenderId ,:offenderBookId ,:txnPostingType ,:txnType ,:txnEntryDesc ,:txnEntryAmount ,date_trunc('D'::text,:txnEntryDate::timestamp) ,:subAccountType ,:txnReferenceNumber ,:modifyDate ,:receiptNumber ,:slipPrintedFlag ,:transferCaseloadId ,:receiptPrintedFlag ,:preWithholdAmount ,:deductionFlag ,:closingChequeNumber ,:remitterName ,:payeeCode ,:payeeNameText ,:payeeCorporateId ,:payeePersonId ,:adjustTxnId ,:adjustTxnEntryId ,:adjustOffenderId ,:adjustAccountCode ,:txnAdjustedFlag ,:deductionType ,:infoNumber ,:holdClearFlag ,:holdUntilDate ,:holdNumber ,:grossAmount ,:grossNetFlag ,:remitterId ,:applySpendingLimitAmount ,:receiptPendingPrintFlag ,:sealFlag ,:orgTxnType ,CURRENT_TIMESTAMP ,:createUserId, :createUserId)
}

OTDCNTAC_OFFENDER_TRUST_ACCOUNTS {
	INSERT INTO OFFENDER_TRUST_ACCOUNTS(
           ACCOUNT_CLOSED_FLAG,
           CASELOAD_ID,
           OFFENDER_ID,
           HOLD_BALANCE,
           CURRENT_BALANCE,
           MODIFY_DATE,
           CREATE_USER_ID,
           CREATE_DATETIME)
       VALUES('N',:caseloadId,:offenderId,0,0,date_TRUNC('D',SYSDATE()),upper(:createUserId), SYSDATE())
}

OTDCNTAC_OFFENDER_SUB_ACCOUNTS {
insert
	into
	OFFENDER_SUB_ACCOUNTS(
           CASELOAD_ID,
	OFFENDER_ID,
	TRUST_ACCOUNT_CODE,
	BALANCE,
	LAST_TXN_ID,
	MODIFY_DATE,
	CREATE_USER_ID,
	MODIFY_USER_ID,
           CREATE_DATETIME)
      select
	:caseloadId,
	:offenderId,
	account_code,
	0,
	:lastTxnId,
	date_TRUNC('D', SYSDATE()),
	:createUserId,
	:modifyUserId,
	SYSDATE()
from
	account_codes
where
	sub_account_type is not null
	and caseload_type = (
	select
		CASELOAD_TYPE
	from
		CASELOADS
	where
		CASELOAD_ID in (
		select
			WORKING_CASELOAD_ID
		from
			STAFF_MEMBERS
		where
			USER_ID = :createUserId))
}

OTDCNTAC_SYSPFL_FIND_SYSTEM_PROFILES {
 	SELECT PROFILE_TYPE ,PROFILE_CODE ,DESCRIPTION ,PROFILE_VALUE ,PROFILE_VALUE_2 ,MODIFY_USER_ID ,OLD_TABLE_NAME ,CREATE_DATETIME ,CREATE_USER_ID ,MODIFY_DATETIME ,SEAL_FLAG   FROM SYSTEM_PROFILES 
}

OTDCNTAC_CGWHEN_NEW_FORM_INSTANCE_ {
	SELECT  SYSDATE(), upper(user) FROM DUAL
}

OTDCNTAC_INIT_POST_TRAN_TYPES_TXN_TYPE {
	select
	TXN_TYPE,
	DESCRIPTION TXN_ENTRY_DESC
from
	TRANSACTION_TYPES
where
	ACTIVE_FLAG = 'Y'
	and TXN_TYPE in (
	select
		TXN_TYPE
	from
		TRANSACTION_OPERATIONS
	where
		MODULE_NAME = 'OTDCNTAC'
		and CASELOAD_ID in (
		select
			WORKING_CASELOAD_ID
		from
			STAFF_MEMBERS
		where
			USER_ID = :USER))
	and CASELOAD_TYPE in (
	select
		CASELOAD_TYPE
	from
		CASELOADS
	where
		CASELOAD_ID in (
		select
			WORKING_CASELOAD_ID
		from
			STAFF_MEMBERS
		where
			USER_ID = :USER))
}

OTDCNTAC_INIT_POST_TRAN_TYPES_SUB_ACCOUNT_TYPE {
	select
	SUB_ACCOUNT_TYPE
from
	ACCOUNT_CODES
where
	ACCOUNT_CODE = (
	select
		CR_ACCOUNT_CODE
	from
		TRANSACTION_OPERATIONS
	where
		MODULE_NAME = 'OTDCNTAC'
		and TXN_TYPE = :TXNTYPE
		and CASELOAD_ID in (
		select
			WORKING_CASELOAD_ID
		from
			STAFF_MEMBERS
		where
			USER_ID = :USER))
	and CASELOAD_TYPE in (
	select
		CASELOAD_TYPE
	from
		CASELOADS
	where
		CASELOAD_ID in (
		select
			WORKING_CASELOAD_ID
		from
			STAFF_MEMBERS
		where
			USER_ID = :USER))
}

OTDCNTAC_TXN_ID {
	SELECT NEXTVAL('TXN_ID')
}

OTDCNTAC_TXN_ENTRY_SEQ {
	select
	coalesce (MAX(TXN_ENTRY_SEQ),
	0) + 1 TXN_ENTRY_SEQ
from
	OFFENDER_TRANSACTIONS
where
	TXN_ID = :TXNID
}

OTDCNTAC_DR_ACCOUNT_CODE_CR_ACCOUNT_CODE {
	select
	DR_ACCOUNT_CODE ADJUST_ACCOUNT_CODE,
	CR_ACCOUNT_CODE ORG_TXN_TYPE,
	TXN_TYPE
from
	TRANSACTION_OPERATIONS
where
	MODULE_NAME = 'OTDCNTAC'
	and CASELOAD_ID in (
	select
		WORKING_CASELOAD_ID
	from
		STAFF_MEMBERS
	where
		USER_ID = :USER)
}

OTDCNTAC_TRANSACTION_OPERATIONS_Y {
	select
	'Y'
from
	TRANSACTION_OPERATIONS
where
	CR_ACCOUNT_CODE =
          	    (
	select
		ACCOUNT_CODE
	from
		ACCOUNT_CODES
	where
		SUB_ACCOUNT_TYPE = :PSUBACTTYPE
		and CASELOAD_TYPE in (
		select
			CASELOAD_TYPE
		from
			CASELOADS
		where
			CASELOAD_ID in (
			select
				WORKING_CASELOAD_ID
			from
				STAFF_MEMBERS
			where
				USER_ID = :USER)))
	and RECEIPT_PRODUCTION_FLAG = 'Y'
	and TXN_TYPE = :PTXNTYPE
	and MODULE_NAME = 'OTDCNTAC'
	and CASELOAD_ID in (
	select
		WORKING_CASELOAD_ID
	from
		STAFF_MEMBERS
	where
		USER_ID = :USER)
}
OTDCNTAC_RECEIPT_NUMBER {
	 select nextval('#SEQ') from dual
}

OTDCNTAC_ACCOUNT_CODE {
	SELECT ACCOUNT_CODE
            	   FROM   ACCOUNT_CODES
              	 WHERE  SUB_ACCOUNT_TYPE = :PSUBACTTYPE 
								 AND    CASELOAD_TYPE IN (SELECT CASELOAD_TYPE FROM CASELOADS WHERE CASELOAD_ID IN (SELECT WORKING_CASELOAD_ID FROM STAFF_MEMBERS WHERE USER_ID = :USER))
}

OTDCNTAC_DEDUCTION_TYPE {
	SELECT DEDUCTION_TYPE 
      FROM OFFENDER_DEDUCTIONS
     WHERE OFFENDER_ID = :POFFID
}

OTDCNTAC_ALL_TABLES {
	select upper(TABLE_NAME) from information_schema.tables t  where upper(table_name)='OBLIGATION_GROUPS'
}

OTDCNTAC_CASELOAD_CODE {
	SELECT CASELOAD_CODE FROM DEDUCTION_TYPES WHERE DEDUCTION_TYPE = :DEDUCTIONTYPE
}

OTDCNTAC_GROUP_ID {
SELECT GROUP_ID 
	          FROM GROUPED_OBLIGATIONS
	         WHERE DEDUCTION_TYPE = :DEDUCTIONTYPE
}

OTDCNTAC_UPDATE_OFFENDER_DEDUCTIONS {
UPDATE OFFENDER_DEDUCTIONS SET GROUP_ID = :groupId, MODIFY_DATETIME = CURRENT_TIMESTAMP ,MODIFY_USER_ID = :modifyUserId
	                 WHERE OFFENDER_ID = :offenderId
                     AND DEDUCTION_TYPE = :deductionType
}

OTDCNTAC_GETTING_OLD_OFFENDER_DEDUCTIONS{
 select * from OFFENDER_DEDUCTIONS  WHERE OFFENDER_ID = :offenderId  AND DEDUCTION_TYPE = :deductionType
}
